# WebView2 缓存功能测试指南

## 测试步骤

1. **编译并运行程序**
   - 在Visual Studio中打开ctwebplayer.sln
   - 编译并运行项目

2. **测试缓存功能**
   - 程序启动后，在地址栏输入测试页面路径：
     ```
     file:///[项目路径]/test/cache_test.html
     ```
   - 或者直接访问在线网站测试，如默认的游戏页面

3. **观察缓存效果**
   - 查看状态栏显示的缓存信息：
     - 缓存命中次数
     - 缓存未命中次数
     - 缓存命中率
     - 缓存大小
   
4. **验证缓存工作**
   - 首次加载页面时，所有资源都会显示"未命中"（下载并缓存）
   - 刷新页面（F5或点击刷新按钮）
   - 再次加载时，应该看到"缓存命中"次数增加
   - 缓存命中率应该提高

5. **查看缓存文件**
   - 缓存文件存储在：`./cache/` 目录下
   - 目录结构与URL路径对应，例如：
     ```
     ./cache/
     ├── cdn.jsdelivr.net/
     │   └── npm/
     │       └── bootstrap@5.3.0/
     │           └── dist/
     │               └── css/
     │                   └── bootstrap.min.css_[hash].css
     ├── code.jquery.com/
     │   └── jquery-3.6.0.min.js_[hash].js
     └── via.placeholder.com/
         └── 400x300/
             └── 007bff/
                 └── ffffff_[hash].png
     ```

6. **测试缓存管理功能**
   - 点击"设置"按钮
   - 选择"缓存管理" -> "查看缓存信息"查看详细统计
   - 选择"缓存管理" -> "清理缓存"清空所有缓存

## 缓存策略说明

根据html_report.md中的建议，实现了以下缓存策略：

1. **长期缓存的资源类型**：
   - JavaScript文件（.js）
   - CSS文件（.css）
   - 图片文件（.jpg, .jpeg, .png, .gif, .webp, .svg, .ico）
   - 字体文件（.woff, .woff2, .ttf, .eot, .otf）

2. **不缓存的资源**：
   - API请求（包含/api/、/v1/、/v2/的URL）
   - 动态内容

3. **版本控制**：
   - 对于带查询参数的URL（如?v=xxx），使用URL哈希值区分不同版本
   - 确保更新的资源能够正确缓存

## 日志输出

程序使用Console.WriteLine输出日志信息，可以在Visual Studio的输出窗口查看：
- 缓存初始化信息
- 资源下载信息
- 缓存命中信息
- 错误信息

## 注意事项

1. 缓存目录会自动创建，无需手动创建
2. 缓存文件名包含哈希值，用于区分不同版本的同名文件
3. 缓存机制是异步的，不会阻塞UI线程
4. 如果缓存失败，不会影响正常浏览，资源会直接从网络加载