<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缓存功能测试页面</title>
    
    <!-- 测试CSS缓存 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .resource-list {
            margin-top: 10px;
        }
        .resource-item {
            padding: 5px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 3px;
            font-size: 12px;
            word-break: break-all;
        }
        .success {
            color: green;
        }
        .loading {
            color: orange;
        }
        .error {
            color: red;
        }
        #test-image {
            max-width: 200px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebView2 缓存功能测试</h1>
        
        <div class="test-section">
            <h2>测试说明</h2>
            <p>这个页面用于测试WebView2浏览器的缓存功能。页面会加载各种类型的静态资源：</p>
            <ul>
                <li>CSS文件（Bootstrap和Font Awesome）</li>
                <li>JavaScript文件（jQuery和Bootstrap）</li>
                <li>图片文件</li>
                <li>字体文件（通过Font Awesome）</li>
            </ul>
            <p>请观察状态栏中的缓存命中信息。刷新页面时，应该看到缓存命中率增加。</p>
        </div>
        
        <div class="test-section">
            <h2>资源加载状态</h2>
            <div id="resource-status" class="resource-list">
                <div class="resource-item loading">正在检测资源加载状态...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>测试内容</h2>
            
            <h3>1. CSS样式测试</h3>
            <button class="btn btn-primary">Bootstrap按钮样式</button>
            <i class="fas fa-check-circle success" style="margin-left: 10px;"></i> Font Awesome图标
            
            <h3>2. 图片测试</h3>
            <img id="test-image" src="https://via.placeholder.com/400x300/007bff/ffffff?text=缓存测试图片" alt="测试图片">
            
            <h3>3. JavaScript测试</h3>
            <button id="js-test-btn" class="btn btn-success">点击测试JavaScript</button>
            <div id="js-result" style="margin-top: 10px;"></div>
        </div>
        
        <div class="test-section">
            <h2>缓存测试操作</h2>
            <button class="btn btn-info" onclick="location.reload()">刷新页面</button>
            <button class="btn btn-warning" onclick="testDynamicLoad()">动态加载资源</button>
            <div id="dynamic-result" style="margin-top: 10px;"></div>
        </div>
    </div>
    
    <!-- 测试JavaScript缓存 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 记录资源加载状态
        const resources = [];
        
        // 监听资源加载
        function checkResourceLoading() {
            const statusDiv = document.getElementById('resource-status');
            statusDiv.innerHTML = '';
            
            // CSS资源
            const cssLinks = document.querySelectorAll('link[rel="stylesheet"]');
            cssLinks.forEach(link => {
                const item = document.createElement('div');
                item.className = 'resource-item success';
                item.textContent = `[CSS] ${link.href}`;
                statusDiv.appendChild(item);
            });
            
            // JavaScript资源
            const scripts = document.querySelectorAll('script[src]');
            scripts.forEach(script => {
                const item = document.createElement('div');
                item.className = 'resource-item success';
                item.textContent = `[JS] ${script.src}`;
                statusDiv.appendChild(item);
            });
            
            // 图片资源
            const images = document.querySelectorAll('img[src]');
            images.forEach(img => {
                const item = document.createElement('div');
                item.className = 'resource-item';
                if (img.complete && img.naturalHeight !== 0) {
                    item.className += ' success';
                    item.textContent = `[图片] ${img.src} - 加载成功`;
                } else {
                    item.className += ' loading';
                    item.textContent = `[图片] ${img.src} - 加载中...`;
                }
                statusDiv.appendChild(item);
            });
        }
        
        // jQuery测试
        $(document).ready(function() {
            $('#js-test-btn').click(function() {
                $('#js-result').html('<div class="alert alert-success">jQuery工作正常！时间：' + new Date().toLocaleTimeString() + '</div>');
            });
            
            // 检查资源加载状态
            setTimeout(checkResourceLoading, 1000);
        });
        
        // 动态加载资源测试
        function testDynamicLoad() {
            const resultDiv = document.getElementById('dynamic-result');
            resultDiv.innerHTML = '<div class="alert alert-info">正在动态加载新图片...</div>';
            
            const img = new Image();
            const timestamp = new Date().getTime();
            img.src = `https://picsum.photos/200/150?random=${timestamp}`;
            
            img.onload = function() {
                resultDiv.innerHTML = '<div class="alert alert-success">动态图片加载成功！</div>';
                resultDiv.appendChild(img);
                setTimeout(checkResourceLoading, 100);
            };
            
            img.onerror = function() {
                resultDiv.innerHTML = '<div class="alert alert-danger">动态图片加载失败！</div>';
            };
        }
        
        // 页面加载完成后检查
        window.addEventListener('load', function() {
            console.log('页面加载完成');
            checkResourceLoading();
        });
    </script>
</body>
</html>