# 调试修复测试说明

## 修复内容总结

### 1. F11和F4快捷键问题修复
- 添加了调试日志记录，可以在日志中查看按键事件是否触发
- 实现了WebView2_PreviewKeyDown事件处理，防止WebView2拦截F11和F4键
- 修复了代码结构错误

### 2. 静音功能增强
- 尝试使用WebView2原生的IsMuted属性（如果可用）
- 增强的JavaScript静音控制：
  - 同时设置muted和volume属性
  - 监听播放和音量变化事件，确保静音状态保持
  - 处理Unity WebGL音频上下文
  - 处理Web Audio API
  - 使用MutationObserver监听新添加的媒体元素
  - 针对游戏页面的特定静音方法

## 测试步骤

### 测试F11和F4快捷键

1. **启动应用程序**
   - 运行ctwebplayer.exe
   - 等待WebView2初始化完成

2. **测试F11全屏切换**
   - 在主窗口按F11键
   - 应该看到：
     - 窗口进入全屏模式
     - 工具栏和状态栏隐藏
     - 显示"按F11退出全屏"提示
   - 再次按F11应该退出全屏

3. **测试F4静音切换**
   - 在主窗口按F4键
   - 应该看到：
     - 显示静音状态提示（🔇静音已开启 或 🔊静音已关闭）
     - 状态栏显示当前静音状态
   - 播放有声音的网页内容验证静音是否生效

4. **在网页内容获得焦点时测试**
   - 点击网页内容区域
   - 再次测试F11和F4键
   - 快捷键应该仍然有效

### 测试静音功能

1. **测试普通网页音频**
   - 访问包含音频/视频的网页（如YouTube）
   - 按F4切换静音
   - 验证声音是否被静音

2. **测试Unity WebGL游戏**
   - 访问Unity WebGL游戏页面
   - 等待游戏加载完成
   - 按F4切换静音
   - 验证游戏声音是否被静音

3. **测试动态加载的音频**
   - 在静音状态下，触发新的音频播放
   - 验证新音频也被静音

## 查看调试日志

1. **打开日志查看器**
   - 点击"设置"按钮
   - 选择"查看日志"

2. **关键日志信息**
   - `Form1构造函数：KeyPreview = True` - 确认KeyPreview已启用
   - `Form1_KeyDown触发：键码 = F11` - 确认F11键被捕获
   - `Form1_KeyDown触发：键码 = F4` - 确认F4键被捕获
   - `WebView2_PreviewKeyDown触发` - 确认WebView2键盘事件被处理
   - `静音状态已切换为：开启/关闭` - 确认静音切换成功

## 问题排查

如果快捷键仍然无效：
1. 确保应用程序窗口有焦点
2. 检查是否有其他程序拦截了F11/F4键
3. 查看日志中是否有错误信息

如果静音功能仍然无效：
1. 检查浏览器控制台（F12）是否有JavaScript错误
2. 某些网站可能使用特殊的音频实现，需要刷新页面后再试
3. 查看日志中的静音相关信息

## 已知限制

1. 跨域iframe中的音频可能无法被静音（浏览器安全限制）
2. 某些使用Flash或其他插件的音频可能不受控制
3. 需要在音频开始播放前设置静音才能确保生效